{% extends 'base_layout.html' %}
{% block content %}



    {% if messages %}
        {% for message in messages %}


            {% if message.tags == 'warning' %}

                <div class="alert alert-danger alert-dismissible">
                    <button type="button" class="close" data-dismiss="alert" aria-hidden="true">×</button>
                    <h4><i class="icon fa fa-ban"></i> Hata !</h4>


                    <ul class="messages">
                        {% for message in messages %}
                            <li class="{{ message.tags }}">{{ message }}</li>
                        {% endfor %}
                    </ul>


                </div>

            {% endif %}


            {% if message.tags == 'success' %}

                <div class="alert alert-success alert-dismissible">
                    <button type="button" class="close" data-dismiss="alert" aria-hidden="true">×</button>
                    <h4><i class="icon fa fa-check"></i> Başarılı !</h4>


                    <ul class="messages">
                        {% for message in messages %}
                            <li class="{{ message.tags }}">{{ message }}</li>
                        {% endfor %}
                    </ul>


                </div>

            {% endif %}
        {% endfor %}


    {% endif %}

    <section class="content">

        <!-- /.row -->
        <!-- Main row -->
        <div class="row">
            <section class="col-lg-3 ">

            </section>


            <section class="col-lg-6 ">


                <div class="box-body">


                    <div class="box box-primary">
                        <div class="box-header with-border">
                            <h3 class="box-title">Sipariş Oluştur</h3>
                            <p style="float: right; font-size:160%;" id="price1">Toplam :0 ₺</p>
                        </div>
                        <!-- /.box-header -->
                        <!-- form start -->
                        <form method="post" role="form">
                            <div class="box-body">
                                {% csrf_token %}


                                <div class="form-group">
                                    <label> {{ order_form.profile.label }}</label>
                                    {{ order_form.profile }}
                                </div>



                                <div class="dropdown form-group">

                                    <label> Ürünler</label>
                                    {{ order_form.droptxt }}
                                    <textarea type="text" id="droptxt" class="list form-control" rows="4" cols="50"></textarea>
                                    <div id="contents" class="contents">

                                        {% for product in products %}
                                            <div class="list">
                                                <input type="checkbox" id="{{ product.id }}" class="list"
                                                       value="{{ product.name }}" name="{{ product.price }}"/>
                                                <label for="apple" class="list">{{ product.name }} ( {{ product.price }}
                                                    ₺)</label>
                                                <input type="hidden" class="list quantity" min="1" value="1"/>
                                            </div>
                                        {% endfor %}


                                    </div>
                                </div>

                                <div class="form-group">
                                    <label> {{ order_form.city.label }}</label>
                                    {{ order_form.city }}
                                </div>


                                <div class="form-group">
                                    <label> {{ order_form.district.label }}</label>
                                    {{ order_form.district }}
                                </div>


                                <div class="form-group">
                                    <label> {{ order_form.address.label }}</label>
                                    {{ order_form.address }}
                                </div>

                                <div class="form-group">
                                    <label> {{ order_form.payment_type.label }}</label>
                                    {{ order_form.payment_type }}
                                </div>

                                <div class="form-group">
                                    <label> {{ order_form.order_situations.label }}</label>
                                    {{ order_form.order_situations }}
                                </div>


                                <div class="checkbox">
                                        <label>
                                            {{ order_form.isContract }}
                                            <a href="#">Satış Sözleşmesini</a>
                                            okudum,anladım,onaylıyorum
                                        </label>
                                    </div>

                            </div>
                            <!-- /.box-body -->

                            <div class="box-footer">
                                <button type="submit" class="btn btn-primary">Kaydet</button>
                                <p style="float: right; font-size:160%;" id="price">Toplam :0 ₺</p>
                            </div>
                        </form>
                    </div>
                    <!-- /.box -->


                </div>
            </section>

            <section class="col-lg-3 ">
            </section>


        </div>


    </section>

    <script>

        var txt = document.getElementById('droptxt'),
            txt2 = document.getElementById('id_droptxt'),
            content = document.getElementById('contents'),
            list = document.querySelectorAll('.contents input[type="checkbox"]'),
            quantity = document.querySelectorAll('.quantity');


        txt.addEventListener('click', function () {
            content.classList.toggle('show')
        })



        // Close the dropdown if the user clicks outside of it
        window.onclick = function (e) {
             var str = document.getElementById('droptxt').value;
             if (str === ""){
                   document.getElementById('price').innerHTML = "Toplam :" +0 + " ₺";
              document.getElementById('price1').innerHTML = "Toplam :" +0 + " ₺";
             }

            if (!e.target.matches('.list')) {
                if (content.classList.contains('show')) content.classList.remove('show')
            }
        }

        list.forEach(function (item, index) {
            item.addEventListener('click', function () {
                quantity[index].type = (item.checked) ? 'number' : 'hidden';
                calc()
            })
        })

        quantity.forEach(function (item) {
            item.addEventListener('input', calc)
        })

        function calc() {
            for (var i = 0, arr = []; i < list.length; i++) {
                if (list[i].checked) arr.push(quantity[i].value + ' x ' + list[i].value + '(' + list[i].name + ')')

            }

            for (var i = 0, arr2 = []; i < list.length; i++) {
                if (list[i].checked) arr2.push(quantity[i].value + ' x ' + list[i].id)

            }

            txt.value = arr.join('- \n')
            myFunction()
            txt2.value = arr2.join(', ')

        }


        function myFunction() {
            var deger = 0;
            var str = document.getElementById('droptxt').value;
            var res = str.split("-");
            for (index = 0; index < res.length; ++index) {

                res1 = res[index].split('x');

                var mySubString = res1[1].substring(
                    res1[1].lastIndexOf("(") + 1,
                    res1[1].lastIndexOf(")")
                );

                deger = deger + (parseInt(res1[0].trim(), 10) * parseFloat(mySubString.trim()));




            }
            if (res.length === 0){
                deger =0;
            }
            document.getElementById('price').innerHTML = "Toplam :" +deger + " ₺";
              document.getElementById('price1').innerHTML = "Toplam :" +deger + " ₺";
            deger =0
        }


    </script>

    <style>

        #droptxt {
            padding: 8px;
            /*width: 300px; */
            cursor: pointer;
            box-sizing: border-box
        }

        .dropdown {
            position: relative;
            /*display: inline-block */
        }

        .contents {
            display: none;
            position: absolute;
            background-color: #f1f1f1;
            width: 100%;
            overflow: auto;
            box-shadow: 0 8px 16px 0 rgba(0, 0, 0, .2);
            z-index: 1
        }

        .quantity {
            float: right;
            width: 40px
        }

        .contents div {
            padding: 10px 15px
        }

        .contents div:hover {
            background-color: #ddd
        }

        .show {
            display: block
        }
    </style>






{% endblock %}